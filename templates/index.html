<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chatbot</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

:root {
    --accent: #6366f1;
    --accent-light: #818cf8;
    --accent-dark: #4f46e5;
    --glass: rgba(255,255,255,0.08);
    --glass-strong: rgba(255,255,255,0.12);
    --border: rgba(255,255,255,0.2);
    --text: #f8fafc;
    --muted: #94a3b8;
    --shadow: rgba(99,102,241,0.4);
}

* { 
    box-sizing: border-box; 
    margin: 0;
    padding: 0;
}

body {
    height: 100vh;
    font-family: 'Inter', sans-serif;
    color: var(--text);
    /* Outer background for screens larger than 1980x1080 */
    background: #050a14; 
    display: flex;
    align-items: center; /* Center vertically on large screens */
    justify-content: center; /* Center horizontally on large screens */
    overflow: hidden;
}

/* --- RESOLUTION FIX CONTAINER --- */
.app-frame {
    width: 100%;
    height: 100%;
    
    /* Desktop Fixed Resolution Constraints */
    max-width: 1980px;  /* User requested 1980px */
    max-height: 1080px; /* Standard HD Height */
    
    display: flex;
    position: relative;
    overflow: hidden; /* Keeps animations inside the frame */
    background: #0f172a; /* Your original background color */
    box-shadow: 0 0 50px rgba(0,0,0,0.5); /* Shadow to separate app from outer bg on large screens */
}

/* --- UNIVERSAL MOBILE SUPPORT --- */
@media screen and (max-width: 1980px) {
    .app-frame {
        max-width: 100%;
        max-height: 100%;
        border-radius: 0;
    }
}
/* -------------------------------- */

/* Animated background applied to the FRAME, not the body, so it stays contained */
.app-frame::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(99,102,241,0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139,92,246,0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(59,130,246,0.1) 0%, transparent 50%);
    animation: bgShift 15s ease infinite;
    z-index: 0;
    pointer-events: none;
}

@keyframes bgShift {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(50px, -30px) scale(1.1); }
    66% { transform: translate(-30px, 50px) scale(0.95); }
}

/* Advanced ambient light effects */
.ambient-light {
    position: absolute;
    border-radius: 50%;
    filter: blur(120px);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: screen;
    will-change: transform, opacity;
}

.light-1 {
    width: 800px;
    height: 800px;
    background: radial-gradient(circle, rgba(99,102,241,0.8) 0%, rgba(139,92,246,0.4) 40%, transparent 70%);
    top: -300px;
    left: -300px;
    animation: moveLight1 25s ease-in-out infinite;
}

.light-2 {
    width: 700px;
    height: 700px;
    background: radial-gradient(circle, rgba(139,92,246,0.7) 0%, rgba(168,85,247,0.4) 40%, transparent 70%);
    bottom: -250px;
    right: -250px;
    animation: moveLight2 22s ease-in-out infinite;
}

.light-3 {
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(59,130,246,0.6) 0%, rgba(96,165,250,0.3) 40%, transparent 70%);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: moveLight3 28s ease-in-out infinite;
}

.light-4 {
    width: 750px;
    height: 750px;
    background: radial-gradient(circle, rgba(168,85,247,0.6) 0%, rgba(217,70,239,0.3) 40%, transparent 70%);
    top: 10%;
    right: 5%;
    animation: moveLight4 30s ease-in-out infinite;
}

.light-5 {
    width: 650px;
    height: 650px;
    background: radial-gradient(circle, rgba(236,72,153,0.5) 0%, rgba(219,39,119,0.3) 40%, transparent 70%);
    bottom: 30%;
    left: 20%;
    animation: moveLight5 26s ease-in-out infinite;
}

.light-6 {
    width: 550px;
    height: 550px;
    background: radial-gradient(circle, rgba(34,211,238,0.5) 0%, rgba(6,182,212,0.3) 40%, transparent 70%);
    top: 30%;
    left: 15%;
    animation: moveLight6 24s ease-in-out infinite;
}

@keyframes moveLight1 {
    0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.5;
    }
    20% { 
        transform: translate(200px, 300px) scale(1.4);
        opacity: 0.8;
    }
    40% { 
        transform: translate(400px, 200px) scale(1.1);
        opacity: 0.6;
    }
    60% { 
        transform: translate(300px, 400px) scale(1.6);
        opacity: 0.9;
    }
    80% { 
        transform: translate(100px, 250px) scale(1.2);
        opacity: 0.7;
    }
}

@keyframes moveLight2 {
    0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.5;
    }
    25% { 
        transform: translate(-250px, -200px) scale(1.5);
        opacity: 0.85;
    }
    50% { 
        transform: translate(-150px, -350px) scale(1.2);
        opacity: 0.65;
    }
    75% { 
        transform: translate(-300px, -150px) scale(1.3);
        opacity: 0.75;
    }
}

@keyframes moveLight3 {
    0%, 100% { 
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
        opacity: 0.4;
    }
    16% { 
        transform: translate(-30%, -70%) scale(1.6) rotate(60deg);
        opacity: 0.7;
    }
    33% { 
        transform: translate(-80%, -30%) scale(1.3) rotate(120deg);
        opacity: 0.6;
    }
    50% { 
        transform: translate(-60%, -80%) scale(1.5) rotate(180deg);
        opacity: 0.8;
    }
    66% { 
        transform: translate(-20%, -60%) scale(1.2) rotate(240deg);
        opacity: 0.65;
    }
    83% { 
        transform: translate(-70%, -40%) scale(1.4) rotate(300deg);
        opacity: 0.75;
    }
}

@keyframes moveLight4 {
    0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.45;
    }
    14% { 
        transform: translate(-200px, 150px) scale(1.4);
        opacity: 0.75;
    }
    28% { 
        transform: translate(-350px, 300px) scale(1.1);
        opacity: 0.55;
    }
    42% { 
        transform: translate(-150px, 250px) scale(1.6);
        opacity: 0.85;
    }
    57% { 
        transform: translate(-300px, 100px) scale(1.2);
        opacity: 0.65;
    }
    71% { 
        transform: translate(-100px, 350px) scale(1.5);
        opacity: 0.8;
    }
    85% { 
        transform: translate(-250px, 200px) scale(1.3);
        opacity: 0.7;
    }
}

@keyframes moveLight5 {
    0%, 100% { 
        transform: translate(0, 0) scale(1) rotate(0deg);
        opacity: 0.4;
    }
    33% { 
        transform: translate(250px, -200px) scale(1.5) rotate(120deg);
        opacity: 0.7;
    }
    66% { 
        transform: translate(100px, -350px) scale(1.2) rotate(240deg);
        opacity: 0.6;
    }
}

@keyframes moveLight6 {
    0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.4;
    }
    25% { 
        transform: translate(300px, 200px) scale(1.4);
        opacity: 0.75;
    }
    50% { 
        transform: translate(150px, 350px) scale(1.1);
        opacity: 0.55;
    }
    75% { 
        transform: translate(250px, 100px) scale(1.3);
        opacity: 0.65;
    }
}

/* Floating particles */
.particles {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 1;
    pointer-events: none;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--accent-light);
    border-radius: 50%;
    opacity: 0.3;
    filter: blur(1px);
    animation: float linear infinite;
}

@keyframes float {
    0% { 
        transform: translateY(100vh) scale(0);
        opacity: 0;
    }
    10% { opacity: 0.3; }
    90% { opacity: 0.3; }
    100% { 
        transform: translateY(-100px) scale(1);
        opacity: 0;
    }
}

/* Sidebar */
.sidebar {
    width: 280px;
    backdrop-filter: blur(40px);
    background: rgba(15,23,42,0.7);
    border-right: 1px solid var(--border);
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    transform: translateX(0);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 40;
    position: relative;
    box-shadow: 4px 0 24px rgba(0,0,0,0.3);
}

.sidebar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

.brand {
    font-size: 1.75rem;
    font-weight: 700;
    background: linear-gradient(135deg, #fff 0%, #818cf8 50%, #6366f1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: brandGlow 3s ease-in-out infinite;
}

.brand i {
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: rotate 4s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes brandGlow {
    0%, 100% { filter: drop-shadow(0 0 8px rgba(99,102,241,0.3)); }
    50% { filter: drop-shadow(0 0 16px rgba(99,102,241,0.6)); }
}

.new-chat-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    border: none;
    padding: 14px 20px;
    border-radius: 16px;
    color: white;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.95rem;
    box-shadow: 0 8px 32px var(--shadow);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.new-chat-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.new-chat-btn:hover::before {
    width: 300px;
    height: 300px;
}

.new-chat-btn:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 12px 48px var(--shadow);
}

.new-chat-btn:active {
    transform: translateY(-1px) scale(0.98);
}

/* Main content */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 2;
}

.chat-container {
    flex: 1;
    padding: 40px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
    padding-bottom: 160px;
    scroll-behavior: smooth;
}

.chat-container::-webkit-scrollbar {
    width: 8px;
}

.chat-container::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
}

.chat-container::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 4px;
}

/* Messages */
.message {
    max-width: 75%;
    padding: 18px 24px;
    border-radius: 20px;
    font-size: 0.95rem;
    line-height: 1.7;
    animation: msgSlideIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    word-wrap: break-word;
    overflow-wrap: break-word;
    direction: auto;
    unicode-bidi: plaintext;
}

.message-actions {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 6px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.message:hover .message-actions {
    opacity: 1;
}

.action-btn {
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    width: 32px;
    height: 32px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    transition: all 0.2s ease;
}

.action-btn:hover {
    background: rgba(0,0,0,0.6);
    border-color: var(--accent-light);
    transform: scale(1.1);
}

.action-btn:active {
    transform: scale(0.95);
}

.copied-tooltip {
    position: absolute;
    top: -35px;
    right: 0;
    background: var(--accent);
    color: white;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    white-space: nowrap;
    animation: tooltipFade 2s ease forwards;
    pointer-events: none;
}

@keyframes tooltipFade {
    0% { opacity: 0; transform: translateY(5px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-5px); }
}

.message-image {
    max-width: 100%;
    border-radius: 12px;
    margin: 12px 0;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: transform 0.3s ease;
}

.message-image:hover {
    transform: scale(1.02);
}

.image-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.image-btn {
    background: var(--glass-strong);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    padding: 8px 16px;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
}

.image-btn:hover {
    background: var(--accent);
    border-color: var(--accent-light);
    transform: translateY(-2px);
}

@keyframes msgSlideIn {
    from { 
        opacity: 0; 
        transform: translateY(30px) scale(0.9);
        filter: blur(4px);
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

.message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
    color: white;
    border-bottom-right-radius: 6px;
    box-shadow: 0 8px 32px var(--shadow);
    animation: msgSlideInRight 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes msgSlideInRight {
    from { 
        opacity: 0; 
        transform: translateX(30px) translateY(20px) scale(0.9);
    }
    to { 
        opacity: 1; 
        transform: translateX(0) translateY(0) scale(1);
    }
}

.message.bot {
    align-self: flex-start;
    background: var(--glass-strong);
    backdrop-filter: blur(30px);
    border: 1px solid var(--border);
    border-bottom-left-radius: 6px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    animation: msgSlideInLeft 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes msgSlideInLeft {
    from { 
        opacity: 0; 
        transform: translateX(-30px) translateY(20px) scale(0.9);
    }
    to { 
        opacity: 1; 
        transform: translateX(0) translateY(0) scale(1);
    }
}

.message::after {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    padding: 1px;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1), transparent);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    animation: borderShine 3s ease-in-out infinite;
}

@keyframes borderShine {
    0%, 100% { opacity: 0; }
    50% { opacity: 0.5; }
}

/* Input */
.input-wrapper {
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 900px;
    animation: inputFloat 0.8s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes inputFloat {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.input-box {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--glass-strong);
    backdrop-filter: blur(40px);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 12px 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
    transition: all 0.3s ease;
}

.input-box:focus-within {
    border-color: var(--accent-light);
    box-shadow: 0 12px 48px rgba(99,102,241,0.3), 0 0 0 1px var(--accent-light);
    transform: translateY(-2px);
}

textarea {
    flex: 1;
    resize: none;
    background: transparent;
    border: none;
    color: white;
    font-size: 1rem;
    font-family: inherit;
    max-height: 160px;
    line-height: 1.5;
    direction: auto;
    unicode-bidi: plaintext;
}

textarea::placeholder {
    color: var(--muted);
}

textarea:focus { 
    outline: none; 
}

.send-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 16px;
    color: white;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px var(--shadow);
    position: relative;
    overflow: hidden;
}

.send-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.3), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s;
}

.send-btn:hover::before {
    transform: translateX(100%);
}

.send-btn:hover {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 8px 32px var(--shadow);
}

.send-btn:active {
    transform: scale(0.95) rotate(0deg);
}

/* Typing indicator */
.typing {
    display: flex;
    gap: 6px;
    align-items: center;
    padding: 4px 0;
}

.typing span {
    width: 8px;
    height: 8px;
    background: linear-gradient(135deg, var(--accent-light), var(--accent));
    border-radius: 50%;
    display: inline-block;
    animation: typingBounce 1.4s ease-in-out infinite;
    box-shadow: 0 0 12px var(--shadow);
}

.typing span:nth-child(2) { animation-delay: 0.2s; }
.typing span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingBounce {
    0%, 60%, 100% { 
        transform: translateY(0) scale(1); 
        opacity: 0.7;
    }
    30% { 
        transform: translateY(-12px) scale(1.2); 
        opacity: 1;
    }
}

/* Mobile menu */
.mobile-menu-btn {
    display: none;
    position: fixed;
    top: 20px;
    left: 20px;
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    color: white;
    border: none;
    width: 52px;
    height: 52px;
    border-radius: 16px;
    z-index: 60;
    cursor: pointer;
    box-shadow: 0 8px 32px var(--shadow);
    transition: all 0.3s ease;
}

.mobile-menu-btn:hover {
    transform: scale(1.1);
}

/* Mobile responsive */
@media (max-width: 768px) {
    .sidebar {
        position: fixed;
        height: 100%;
        transform: translateX(-100%);
    }
    .sidebar.active { 
        transform: translateX(0);
        box-shadow: 8px 0 32px rgba(0,0,0,0.5);
    }
    .mobile-menu-btn { display: flex; align-items: center; justify-content: center; }
    .chat-container { padding: 20px; padding-top: 80px; }
    .message { max-width: 90%; }
    .input-wrapper { width: 95%; bottom: 16px; }
}

/* Code blocks in messages */
.message pre {
    background: rgba(0,0,0,0.3);
    padding: 12px;
    border-radius: 8px;
    overflow-x: auto;
    margin: 8px 0;
}

.message code {
    background: rgba(0,0,0,0.2);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
}

.message a {
    color: var(--accent-light);
    text-decoration: none;
    border-bottom: 1px solid var(--accent-light);
    transition: all 0.2s;
}

.message a:hover {
    color: white;
    border-bottom-color: white;
}

/* Credit */
.credit {
    text-align: center;
    margin-top: 12px;
    font-size: 0.85rem;
    font-weight: 500;
    opacity: 0.8;
    animation: fadeIn 1s ease-in-out;
    background: linear-gradient(90deg, 
        var(--muted) 0%, 
        var(--text) 25%, 
        var(--accent-light) 50%, 
        var(--text) 75%, 
        var(--muted) 100%);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: fadeIn 1s ease-in-out, shimmerText 4s ease-in-out infinite;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 0.8; transform: translateY(0); }
}

@keyframes shimmerText {
    0%, 100% { background-position: 200% 0; }
    50% { background-position: -200% 0; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}
</style>
</head>

<body>

<div class="app-frame">

    <div class="ambient-light light-1"></div>
    <div class="ambient-light light-2"></div>
    <div class="ambient-light light-3"></div>
    <div class="ambient-light light-4"></div>
    <div class="ambient-light light-5"></div>
    <div class="ambient-light light-6"></div>

    <div class="particles" id="particles"></div>

    <button class="mobile-menu-btn" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
    </button>

    <div class="sidebar">
        <div class="brand">
            <i class="fas fa-brain"></i>
            AI Chatbot
        </div>
        <button class="new-chat-btn" onclick="clearChat()">
            <i class="fas fa-plus"></i> New Chat
        </button>
    </div>

    <div class="main-content">
        <div class="chat-container" id="chatBox">
            <div class="message bot">✨ Hello! I'm your advanced AI assistant. How can I help you today?</div>
        </div>

        <div class="input-wrapper">
            <div class="input-box">
                <textarea id="userInput" rows="1"
                placeholder="Ask anything..."
                oninput="autoResize(this)"
                onkeydown="handleKeyPress(event)">
                </textarea>
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="credit">Made by Karthik C S</div>
        </div>
    </div>
    
</div> <script>
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');

// Create floating particles
function createParticles() {
    const container = document.getElementById('particles');
    for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
        particle.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(particle);
    }
}

createParticles();

function toggleSidebar() {
    document.querySelector('.sidebar').classList.toggle('active');
}

function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = Math.min(textarea.scrollHeight, 160) + 'px';
}

function handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

function appendMessage(text, sender) {
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    
    // Parse markdown and handle images
    const parsed = marked.parse(text);
    
    // Create message content
    const contentDiv = document.createElement('div');
    contentDiv.innerHTML = parsed;
    
    // Add copy button for bot messages
    if (sender === 'bot') {
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'message-actions';
        actionsDiv.innerHTML = `
            <button class="action-btn" onclick="copyMessage(this)" title="Copy message">
                <i class="fas fa-copy"></i>
            </button>
        `;
        div.appendChild(actionsDiv);
    }
    
    div.appendChild(contentDiv);
    
    // Handle images in the message
    const images = contentDiv.querySelectorAll('img');
    images.forEach((img, index) => {
        img.className = 'message-image';
        img.onclick = () => openImageModal(img.src);
        
        // Add image actions
        const imageActions = document.createElement('div');
        imageActions.className = 'image-actions';
        imageActions.innerHTML = `
            <button class="image-btn" onclick="downloadImage('${img.src}', 'image-${Date.now()}-${index}')">
                <i class="fas fa-download"></i> Download
            </button>
            <button class="image-btn" onclick="openImageModal('${img.src}')">
                <i class="fas fa-expand"></i> View Full
            </button>
        `;
        img.parentNode.insertBefore(imageActions, img.nextSibling);
    });
    
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function copyMessage(btn) {
    const message = btn.closest('.message');
    const messageActions = message.querySelector('.message-actions');
    
    // Get text content, excluding the action buttons
    let textContent = '';
    message.childNodes.forEach(node => {
        if (node !== messageActions && node.nodeType === Node.ELEMENT_NODE) {
            textContent += node.innerText || node.textContent || '';
        }
    });
    
    textContent = textContent.trim();
    
    // Copy to clipboard
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(textContent).then(() => {
            showCopyFeedback(btn);
        }).catch(err => {
            // Fallback method
            fallbackCopy(textContent);
            showCopyFeedback(btn);
        });
    } else {
        // Fallback for older browsers
        fallbackCopy(textContent);
        showCopyFeedback(btn);
    }
}

function fallbackCopy(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
        document.execCommand('copy');
    } catch (err) {
        console.error('Fallback copy failed:', err);
    }
    document.body.removeChild(textArea);
}

function showCopyFeedback(btn) {
    // Show tooltip
    const tooltip = document.createElement('div');
    tooltip.className = 'copied-tooltip';
    tooltip.textContent = 'Copied!';
    btn.style.position = 'relative';
    btn.appendChild(tooltip);
    setTimeout(() => tooltip.remove(), 2000);
    
    // Change icon briefly
    const icon = btn.querySelector('i');
    const originalClass = icon.className;
    icon.className = 'fas fa-check';
    setTimeout(() => {
        icon.className = originalClass;
    }, 2000);
}

function downloadImage(url, filename) {
    fetch(url)
        .then(response => response.blob())
        .then(blob => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename + '.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        })
        .catch(err => {
            console.error('Download failed:', err);
            alert('Failed to download image');
        });
}

function openImageModal(src) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        cursor: pointer;
        animation: fadeIn 0.3s ease;
    `;
    
    const img = document.createElement('img');
    img.src = src;
    img.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        border-radius: 12px;
        box-shadow: 0 20px 80px rgba(0,0,0,0.8);
        animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    `;
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    `;
    
    document.head.appendChild(style);
    modal.appendChild(img);
    document.body.appendChild(modal);
    
    modal.onclick = () => {
        modal.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            modal.remove();
            style.remove();
        }, 300);
    };
}

function appendLoading() {
    const id = 'loader-' + Date.now();
    const div = document.createElement('div');
    div.className = 'message bot';
    div.id = id;
    div.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
    return id;
}

async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;
    
    appendMessage(text, 'user');
    userInput.value = '';
    userInput.style.height = 'auto';

    const loader = appendLoading();
    
    try {
        const res = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        document.getElementById(loader).remove();
        appendMessage(data.response, 'bot');
    } catch (error) {
        document.getElementById(loader).remove();
        appendMessage('⚠️ Connection error. Please try again.', 'bot');
    }
}

async function clearChat() {
    try {
        await fetch('/clear', { method: 'POST' });
        chatBox.innerHTML = '<div class="message bot">✨ Chat cleared. Ready for a fresh start!</div>';
    } catch (error) {
        console.error('Clear chat error:', error);
    }
}

// Close sidebar on outside click (mobile)
document.addEventListener('click', (e) => {
    const sidebar = document.querySelector('.sidebar');
    const menuBtn = document.querySelector('.mobile-menu-btn');
    if (window.innerWidth <= 768 && 
        sidebar.classList.contains('active') && 
        !sidebar.contains(e.target) && 
        !menuBtn.contains(e.target)) {
        sidebar.classList.remove('active');
    }
});
</script>

</body>
</html>
